<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì˜ì—… ë§¤ë‹ˆì € PRO v11.0</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        :root { --hyundai: #002c5f; --kia: #ea0029; --accent: #0076c0; --success: #28a745; --danger: #dc3545; --gray: #666; }
        body { font-family: 'Pretendard', -apple-system, sans-serif; padding: 0; background: #f2f4f7; color: #333; margin: 0; }
        .container { max-width: 500px; margin: auto; padding: 15px; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-tab { display: flex; background: white; border-radius: 15px; margin-bottom: 10px; padding: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; padding: 12px; border: none; background: none; font-weight: bold; border-radius: 10px; cursor: pointer; color: #999; font-size: 0.85em; }
        .nav-btn.active { background: var(--hyundai); color: white; }

        /* ì„¤ì • ë ˆì´ì–´ */
        #settingLayer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: none; }
        .setting-box { background: white; width: 90%; max-width: 400px; margin: 40px auto; padding: 20px; border-radius: 15px; max-height: 80vh; overflow-y: auto; }

        .backup-bar { display: flex; gap: 5px; margin-bottom: 15px; }
        .btn-backup { flex: 1; padding: 8px; background: #555; color: white; border: none; border-radius: 8px; font-size: 0.75em; font-weight: bold; }

        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h2 { color: var(--hyundai); font-size: 1.1em; margin-top: 0; border-left: 4px solid var(--hyundai); padding-left: 10px; display: flex; justify-content: space-between; align-items: center; }
        
        label { display: block; margin-bottom: 4px; font-weight: 600; font-size: 0.8em; color: var(--gray); }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 10px; font-family: inherit; }
        .btn-main { width: 100%; padding: 14px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .stat-box { background: var(--hyundai); color: white; padding: 12px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 1.1em; font-weight: 800; }

        .item { padding: 12px 0; border-bottom: 1px solid #eee; }
        .badge { font-size: 0.7em; padding: 2px 5px; border-radius: 4px; color: white; margin-right: 5px; }
        .st-ì§„í–‰ì¤‘ { background: #ff9800; } .st-ê³„ì•½ { background: #6f42c1; } .st-ì™„ë£Œ { background: var(--success); }
        
        .detail-view { background: #f9f9f9; padding: 12px; border-radius: 8px; margin-top: 5px; font-size: 0.85em; display: none; border: 1px solid #eee; line-height: 1.5; }
        .detail-view.active { display: block; }
        .detail-label { color: var(--accent); font-weight: bold; margin-right: 5px; display: inline-block; width: 65px; }

        .history-list { max-height: 450px; overflow-y: auto; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="backup-bar">
        <button class="btn-backup" onclick="exportData()">CSV ì €ì¥</button>
        <button class="btn-backup" onclick="copyToClipboard()">ì „ì²´ë°ì´í„° ë³µì‚¬</button>
        <button class="btn-backup" onclick="document.getElementById('settingLayer').style.display='block'" style="background:var(--hyundai)">âš™ï¸ ì„¤ì •</button>
    </div>

    <div class="nav-tab">
        <button id="navConsult" class="nav-btn active" onclick="showTab('consult')">1.ìƒë‹´</button>
        <button id="navContract" class="nav-btn" onclick="showTab('contract')">2.ê³„ì•½</button>
        <button id="navSales" class="nav-btn" onclick="showTab('sales')">3.íŒë§¤ì‹¤ì </button>
    </div>

    <div id="tabConsult">
        <div class="card">
            <h2>ìƒë‹´ ë“±ë¡</h2>
            <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                <button id="cBtnH" class="nav-btn active" style="border:1px solid #ddd" onclick="setBrand('H')">í˜„ëŒ€</button>
                <button id="cBtnK" class="nav-btn" style="border:1px solid #ddd" onclick="setBrand('K')">ê¸°ì•„</button>
            </div>
            <input type="text" id="cName" placeholder="ê³ ê°ëª…">
            <input type="date" id="cDate">
            <input type="text" id="cModel" placeholder="ì°¨ì¢… (ì§ì ‘ ì…ë ¥)">
            <textarea id="cNote" placeholder="íŠ¹ì´ì‚¬í•­" rows="2"></textarea>
            <textarea id="cService" placeholder="ì„œë¹„ìŠ¤ ë‚´ìš©" rows="2"></textarea>
            <button class="btn-main" onclick="saveConsult()">ìƒë‹´ ë‚´ì—­ ì €ì¥</button>
        </div>
        <div class="card">
            <h2>ìƒë‹´ í˜„í™©</h2>
            <div id="consultList" class="history-list"></div>
        </div>
    </div>

    <div id="tabContract" class="hidden">
        <div class="card">
            <h2>ê³„ì•½ ê³ ê° ë¦¬ìŠ¤íŠ¸</h2>
            <div id="contractList" class="history-list"></div>
        </div>
    </div>

    <div id="tabSales" class="hidden">
        <div id="salesFinalInput" class="card hidden" style="border: 3px solid var(--success);">
            <h2 style="color:var(--success)">ğŸ’° íŒë§¤ì™„ë£Œ ì •ì‚°</h2>
            <p id="sTargetName" style="font-weight:bold; background:#f8f9fa; padding:10px; border-radius:8px;"></p>
            <label>ì‹¤ì œ ì°¨ëŸ‰ ê°€ê²© (ì›)</label>
            <input type="number" id="sPrice" placeholder="ì°¨ëŸ‰ ê°€ê²© ì…ë ¥" oninput="autoCalcSales()">
            
            <div id="sKiaRatioArea" class="hidden">
                <label>ê¸°ì•„ ìˆ˜ë‹¹ ë¹„ìœ¨</label>
                <select id="sKiaRatio" onchange="autoCalcSales()"><option value="0.9">90%</option><option value="0.8">80%</option></select>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px;">
                <div><label>ìˆ˜ë‹¹(ìë™)</label><input type="number" id="sCalc"></div>
                <div><label>ê¸°íƒ€(+)</label><input type="number" id="sExtra" value="0" oninput="autoCalcSales()"></div>
                <div><label>ì˜ì—…ë¹„(-)</label><input type="number" id="sExp" value="0" oninput="autoCalcSales()"></div>
            </div>
            <div style="text-align:right; font-weight:bold; color:var(--success); margin:10px 0; font-size:1.2em;">
                ìµœì¢… ìˆ˜ìµ: <span id="vFinalNet">0</span>ì›
            </div>
            <button class="btn-main" style="background:var(--success)" onclick="completeFinalSale()">ìµœì¢… ì‹¤ì  ì €ì¥</button>
            <button class="btn-main" style="background:#ccc; margin-top:5px;" onclick="cancelFinalSale()">ì·¨ì†Œ</button>
        </div>

        <div class="card">
            <h2>íŒë§¤ì‹¤ì  ë¦¬í¬íŠ¸ <select id="viewMonth" onchange="renderSales()" style="width:auto;"></select></h2>
            <div id="chart_div" style="width:100%; height:120px;"></div>
            <div class="dashboard">
                <div class="stat-box"><div>íŒë§¤ëŸ‰</div><div class="stat-value"><span id="totalCount">0</span>ëŒ€</div></div>
                <div class="stat-box" style="background: var(--success);"><div>ì´ ìˆ˜ìµ</div><div class="stat-value"><span id="totalIncome">0</span>ì›</div></div>
            </div>
        </div>
        
        <div class="card">
            <h2>íŒë§¤ê³ ê° ë¦¬ìŠ¤íŠ¸</h2>
            <div id="salesList" class="history-list"></div>
        </div>
    </div>

    <div id="settingLayer">
        <div class="setting-box">
            <h2 style="border:none;">âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì • <span onclick="document.getElementById('settingLayer').style.display='none'" style="cursor:pointer; color:#999;">âœ•</span></h2>
            
            <div style="background:#f8f9fa; padding:10px; border-radius:10px; margin-bottom:15px;">
                <label>ê¸°ë³¸ ìˆ˜ë‹¹ ê³„ìˆ˜ (ìˆ˜ì • ê°€ëŠ¥)</label>
                <input type="number" id="setBase" step="0.00001">
                <button class="btn-backup" style="width:100%; background:var(--hyundai)" onclick="saveSettingBase()">ê³„ìˆ˜ ì €ì¥</button>
            </div>

            <div style="background:#f8f9fa; padding:10px; border-radius:10px;">
                <label>ì°¨ì¢… ìš”ìœ¨ ì¶”ê°€/ê´€ë¦¬</label>
                <div style="display:flex; gap:5px; margin-bottom:5px;">
                    <select id="newBrand" style="flex:1;"><option value="H">í˜„ëŒ€</option><option value="K">ê¸°ì•„</option></select>
                    <input type="text" id="newModel" placeholder="ì°¨ì¢…ëª…" style="flex:2;">
                </div>
                <input type="number" id="newRate" placeholder="ìš”ìœ¨ (ì˜ˆ: 0.05)" step="0.001">
                <button class="btn-backup" style="width:100%; background:var(--accent)" onclick="addNewModel()">ì°¨ì¢… ìš”ìœ¨ ì¶”ê°€</button>
            </div>

            <div id="modelListArea" style="margin-top:15px; font-size:0.8em; border-top:1px solid #ddd; padding-top:10px;">
                </div>
        </div>
    </div>
</div>

<script>
    let currentBrand = 'H'; 
    let tempContract = null;
    
    // ì´ˆê¸° ê¸°ë³¸ ë°ì´í„°
    const defH = [{n:'ì•„ë°˜ë–¼', r:0.07}, {n:'ì˜ë‚˜íƒ€', r:0.06}, {n:'ê·¸ëœì €', r:0.05}, {n:'ì‹¼íƒ€í˜', r:0.053}, {n:'GV80', r:0.041}];
    const defK = [{n:'ëª¨ë‹', r:0.075}, {n:'K5', r:0.06}, {n:'ì˜ë Œí† ', r:0.055}, {n:'ì¹´ë‹ˆë°œ', r:0.06}];

    let myBase = JSON.parse(localStorage.getItem('myBase')) || 1.15863;
    let myH = JSON.parse(localStorage.getItem('myH')) || defH;
    let myK = JSON.parse(localStorage.getItem('myK')) || defK;

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(init);

    function init() {
        document.getElementById('cDate').valueAsDate = new Date();
        document.getElementById('setBase').value = myBase;
        initMonthSelector();
        renderConsult();
        renderContract();
        renderSales();
        renderModelSetting();
    }

    function showTab(type) {
        ['Consult', 'Contract', 'Sales'].forEach(t => {
            document.getElementById('tab'+t).classList.toggle('hidden', type.toLowerCase() !== t.toLowerCase());
            document.getElementById('nav'+t).classList.toggle('active', type.toLowerCase() === t.toLowerCase());
        });
        if(type === 'sales') renderSales();
    }

    function setBrand(b) {
        currentBrand = b;
        document.getElementById('cBtnH').classList.toggle('active', b==='H');
        document.getElementById('cBtnK').classList.toggle('active', b==='K');
    }

    // --- 1. ìƒë‹´ ë¡œì§ ---
    function saveConsult() {
        const name = document.getElementById('cName').value.trim();
        const model = document.getElementById('cModel').value.trim();
        if(!name || !model) return alert("ê³ ê°ëª…ê³¼ ì°¨ì¢…ì„ ì…ë ¥í•˜ì„¸ìš”!");

        const data = {
            id: Date.now(),
            brand: currentBrand,
            name,
            date: document.getElementById('cDate').value,
            model,
            note: document.getElementById('cNote').value,
            service: document.getElementById('cService').value
        };

        let list = JSON.parse(localStorage.getItem('consultData') || "[]");
        list.push(data);
        localStorage.setItem('consultData', JSON.stringify(list));
        alert("ìƒë‹´ ì €ì¥ ì™„ë£Œ");
        document.getElementById('cName').value = "";
        document.getElementById('cModel').value = "";
        renderConsult();
    }

    function renderConsult() {
        const list = JSON.parse(localStorage.getItem('consultData') || "[]");
        const listEl = document.getElementById('consultList');
        listEl.innerHTML = list.length ? "" : "<div style='text-align:center;padding:20px;color:#999'>ë‚´ì—­ ì—†ìŒ</div>";
        list.slice().reverse().forEach(item => {
            listEl.innerHTML += `
                <div class="item">
                    <div onclick="toggleDetail('c-${item.id}')" style="display:flex; justify-content:space-between">
                        <strong>${item.name} (${item.model})</strong>
                        <span class="badge st-ì§„í–‰ì¤‘">ìƒë‹´ì¤‘</span>
                    </div>
                    <div id="detail-c-${item.id}" class="detail-view">
                        <p><span class="detail-label">ë¸Œëœë“œ:</span> ${item.brand==='H'?'í˜„ëŒ€':'ê¸°ì•„'}</p>
                        <p><span class="detail-label">íŠ¹ì´ì‚¬í•­:</span> ${item.note || '-'}</p>
                        <p><span class="detail-label">ì„œë¹„ìŠ¤:</span> ${item.service || '-'}</p>
                        <button class="btn-main" style="padding:8px; font-size:0.8em; margin-top:10px;" onclick="moveToContract(${item.id})">ê³„ì•½ ì „í™˜</button>
                        <button onclick="deleteData('consultData', ${item.id}, renderConsult)" style="color:var(--danger); border:none; background:none; font-size:0.8em; float:right; margin-top:15px;">ì‚­ì œ</button>
                    </div>
                </div>`;
        });
    }

    function moveToContract(id) {
        let cList = JSON.parse(localStorage.getItem('consultData') || "[]");
        const item = cList.find(i => i.id === id);
        if(confirm(`[${item.name}] ê³ ê°ë‹˜ì„ ê³„ì•½ ë‹¨ê³„ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            let kList = JSON.parse(localStorage.getItem('contractData') || "[]");
            kList.push(item);
            localStorage.setItem('contractData', JSON.stringify(kList));
            localStorage.setItem('consultData', JSON.stringify(cList.filter(i => i.id !== id)));
            renderConsult();
            renderContract();
            showTab('contract');
        }
    }

    // --- 2. ê³„ì•½ ë¡œì§ ---
    function renderContract() {
        const list = JSON.parse(localStorage.getItem('contractData') || "[]");
        const listEl = document.getElementById('contractList');
        listEl.innerHTML = list.length ? "" : "<div style='text-align:center;padding:20px;color:#999'>ê³„ì•½ ë‚´ì—­ ì—†ìŒ</div>";
        list.slice().reverse().forEach(item => {
            listEl.innerHTML += `
                <div class="item">
                    <div onclick="toggleDetail('k-${item.id}')" style="display:flex; justify-content:space-between">
                        <strong>${item.name} (${item.model})</strong>
                        <span class="badge st-ê³„ì•½">ê³„ì•½ì¤‘</span>
                    </div>
                    <div id="detail-k-${item.id}" class="detail-view">
                        <p><span class="detail-label">ë¸Œëœë“œ:</span> ${item.brand==='H'?'í˜„ëŒ€':'ê¸°ì•„'}</p>
                        <p><span class="detail-label">ì„œë¹„ìŠ¤:</span> ${item.service || '-'}</p>
                        <button class="btn-main" style="padding:8px; font-size:0.8em; background:var(--success); margin-top:10px;" onclick="openFinalInput(${item.id})">íŒë§¤ì™„ë£Œ(ì‹¤ì ì •ì‚°)</button>
                        <button onclick="deleteData('contractData', ${item.id}, renderContract)" style="color:var(--danger); border:none; background:none; font-size:0.8em; float:right; margin-top:15px;">ì‚­ì œ</button>
                    </div>
                </div>`;
        });
    }

    // ì—°ë™ í•¨ìˆ˜: ì‹¤ì  íƒ­ìœ¼ë¡œ ë³´ë‚´ê³  ì •ì‚°ì°½ ë„ì›€
    function openFinalInput(id) {
        const list = JSON.parse(localStorage.getItem('contractData') || "[]");
        tempContract = list.find(i => i.id === id);
        
        showTab('sales');
        document.getElementById('salesFinalInput').classList.remove('hidden');
        document.getElementById('sTargetName').innerText = `ëŒ€ìƒ: ${tempContract.name} (${tempContract.model})`;
        document.getElementById('sKiaRatioArea').classList.toggle('hidden', tempContract.brand !== 'K');
        document.getElementById('sPrice').focus();
        window.scrollTo(0,0);
    }

    // --- 3. ì‹¤ì  ë¡œì§ ---
    function autoCalcSales() {
        if(!tempContract) return;
        const price = parseFloat(document.getElementById('sPrice').value) || 0;
        const extra = parseInt(document.getElementById('sExtra').value) || 0;
        const exp = parseInt(document.getElementById('sExp').value) || 0;

        const models = tempContract.brand === 'H' ? myH : myK;
        const found = models.find(m => m.n === tempContract.model) || {r: 0.05}; // ëª»ì°¾ìœ¼ë©´ 5% ì ìš©
        
        let val = 0;
        if(tempContract.brand === 'H') {
            val = (price / myBase) * found.r * 0.7 * 0.967;
        } else {
            const kiaRatio = parseFloat(document.getElementById('sKiaRatio').value);
            val = (price / myBase) * found.r * kiaRatio * 0.967;
        }

        const calcResult = Math.floor(val);
        document.getElementById('sCalc').value = calcResult;
        document.getElementById('vFinalNet').innerText = (calcResult + extra - exp).toLocaleString();
    }

    function completeFinalSale() {
        if(!tempContract) return;
        const monthKey = document.getElementById('viewMonth').value;
        const calcVal = parseInt(document.getElementById('sCalc').value) || 0;
        const extraVal = parseInt(document.getElementById('sExtra').value) || 0;
        const expVal = parseInt(document.getElementById('sExp').value) || 0;

        const record = {
            ...tempContract,
            finalNet: calcVal + extraVal - expVal,
            calcIncome: calcVal,
            extraIncome: extraVal,
            expense: expVal,
            saleDate: new Date().toLocaleDateString()
        };

        let sList = JSON.parse(localStorage.getItem(monthKey) || "[]");
        sList.push(record);
        localStorage.setItem(monthKey, JSON.stringify(sList));

        // ê³„ì•½ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì œê±°
        let kList = JSON.parse(localStorage.getItem('contractData') || "[]");
        localStorage.setItem('contractData', JSON.stringify(kList.filter(i => i.id !== tempContract.id)));

        alert("ì‹¤ì  ì €ì¥ ì™„ë£Œ!");
        cancelFinalSale();
        renderContract();
        renderSales();
    }

    function cancelFinalSale() {
        tempContract = null;
        document.getElementById('salesFinalInput').classList.add('hidden');
        document.getElementById('sPrice').value = "";
        document.getElementById('sExtra').value = "0";
        document.getElementById('sExp').value = "0";
    }

    function renderSales() {
        const month = document.getElementById('viewMonth').value;
        const data = JSON.parse(localStorage.getItem(month) || "[]");
        let totalNet = 0;
        const listEl = document.getElementById('salesList');
        listEl.innerHTML = data.length ? "" : "<div style='text-align:center;padding:20px;color:#999'>ì‹¤ì  ì—†ìŒ</div>";
        data.slice().reverse().forEach(item => {
            totalNet += item.finalNet;
            listEl.innerHTML += `
                <div class="item" onclick="toggleDetail('s-${item.id}')">
                    <div style="display:flex; justify-content:space-between">
                        <strong>${item.name} (${item.model})</strong>
                        <strong>${item.finalNet.toLocaleString()}ì›</strong>
                    </div>
                    <div id="detail-s-${item.id}" class="detail-view">
                        <p><span class="detail-label">ì •ì‚°ì¼:</span> ${item.saleDate}</p>
                        <p><span class="detail-label">ì„¸ë¶€:</span> ìˆ˜ë‹¹ ${item.calcIncome.toLocaleString()} / ê¸°íƒ€ ${item.extraIncome.toLocaleString()} / ì§€ì¶œ ${item.expense.toLocaleString()}</p>
                        <button onclick="deleteData('${month}', ${item.id}, renderSales)" style="color:var(--danger); border:none; background:none; font-size:0.8em; margin-top:10px;">ì‚­ì œ</button>
                    </div>
                </div>`;
        });
        document.getElementById('totalCount').innerText = data.length;
        document.getElementById('totalIncome').innerText = totalNet.toLocaleString();
        drawChart();
    }

    // --- ì„¤ì • ê´€ë ¨ ê¸°ëŠ¥ ---
    function saveSettingBase() {
        myBase = parseFloat(document.getElementById('setBase').value);
        localStorage.setItem('myBase', JSON.stringify(myBase));
        alert("ê³„ìˆ˜ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function addNewModel() {
        const b = document.getElementById('newBrand').value;
        const n = document.getElementById('newModel').value.trim();
        const r = parseFloat(document.getElementById('newRate').value);
        if(!n || isNaN(r)) return alert("ì°¨ì¢…ëª…ê³¼ ìš”ìœ¨ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.");

        if(b === 'H') myH.push({n, r}); else myK.push({n, r});
        localStorage.setItem('myH', JSON.stringify(myH));
        localStorage.setItem('myK', JSON.stringify(myK));
        alert("ì°¨ì¢… ìš”ìœ¨ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
        document.getElementById('newModel').value = "";
        document.getElementById('newRate').value = "";
        renderModelSetting();
    }

    function renderModelSetting() {
        const area = document.getElementById('modelListArea');
        area.innerHTML = "<strong>í˜„ì¬ ë“±ë¡ëœ ìš”ìœ¨í‘œ</strong><br>";
        myH.forEach((m, idx) => {
            area.innerHTML += `[í˜„ëŒ€] ${m.n}: ${m.r} <span style="color:red" onclick="delModel('H', ${idx})">âœ•</span> | `;
        });
        myK.forEach((m, idx) => {
            area.innerHTML += `[ê¸°ì•„] ${m.n}: ${m.r} <span style="color:red" onclick="delModel('K', ${idx})">âœ•</span> | `;
        });
    }

    function delModel(brand, idx) {
        if(brand === 'H') myH.splice(idx, 1); else myK.splice(idx, 1);
        localStorage.setItem('myH', JSON.stringify(myH));
        localStorage.setItem('myK', JSON.stringify(myK));
        renderModelSetting();
    }

    // --- ìœ í‹¸ë¦¬í‹° ---
    function toggleDetail(id) { const el = document.getElementById(`detail-${id}`); if(el) el.classList.toggle('active'); }
    function deleteData(key, id, callback) { event.stopPropagation(); if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { let list = JSON.parse(localStorage.getItem(key) || "[]").filter(i => i.id !== id); localStorage.setItem(key, JSON.stringify(list)); callback(); } }
    function initMonthSelector() { const sel = document.getElementById('viewMonth'); const now = new Date(); for (let i = 0; i < 12; i++) { let d = new Date(now.getFullYear(), now.getMonth() - i, 1); let k = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`; sel.add(new Option(`${d.getFullYear()}ë…„ ${d.getMonth() + 1}ì›”`, k)); } }
    function drawChart() {
        const months = []; const now = new Date(); for(let i=3; i>=0; i--) { let d = new Date(now.getFullYear(), now.getMonth()-i, 1); months.push(`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2, '0')}`); }
        const chartData = [['Month', 'ìˆ˜ì…']]; months.forEach(m => { const d = JSON.parse(localStorage.getItem(m) || "[]"); chartData.push([m.split('-')[1]+'ì›”', d.reduce((a, c) => a + c.finalNet, 0)]); });
        new google.visualization.LineChart(document.getElementById('chart_div')).draw(google.visualization.arrayToDataTable(chartData), { legend:'none', chartArea:{width:'85%',height:'70%'} });
    }
    function copyToClipboard() { const allData = {}; for (let i = 0; i < localStorage.length; i++) { const key = localStorage.key(i); allData[key] = localStorage.getItem(key); } const textArea = document.createElement("textarea"); textArea.value = JSON.stringify(allData); document.body.appendChild(textArea); textArea.select(); document.execCommand('copy'); alert("ë³µì‚¬ ì™„ë£Œ!"); document.body.removeChild(textArea); }
    function exportData() { const month = document.getElementById('viewMonth').value; const data = JSON.parse(localStorage.getItem(month) || "[]"); if(data.length === 0) return alert("ë°ì´í„° ì—†ìŒ"); let csv = "\ufeffê³ ê°ëª…,ì°¨ì¢…,ìˆ˜ìµ,ë‚ ì§œ\n"; data.forEach(item => { csv += `${item.name},${item.model},${item.finalNet},${item.saleDate}\n`; }); const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = `ì‹¤ì _${month}.csv`; link.click(); }
</script>
</body>
</html>
